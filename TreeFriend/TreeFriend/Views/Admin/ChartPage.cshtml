@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<link rel="stylesheet" href="~/css/Admin/ChartPage.css" />

<div id="chartDiv" class="container-fluid overflow-auto">
    <div class="today-info row justify-content-around text-center m-0">
        <div class="info-item col-4 d-flex align-items-center justify-content-center">
            <img src="~/icon/sales.png" alt="">
            <div class="d-flex flex-column fs-4 text-start ps-2">
                <span>{{todayInfo.sales}}</span>
                <span class="fs-6 sub-title">今日銷售</span>
            </div>
        </div>
        <div class="info-item col-4 d-flex align-items-center justify-content-center">
            <img src="~/icon/todayPost.png" alt="">
            <div class="d-flex flex-column fs-4 text-start ps-2">
                <span>{{todayInfo.postCount}}</span>
                <span class="fs-6 sub-title">今日貼文</span>
            </div>
        </div>
        <div class="info-item col-4 d-flex align-items-center justify-content-center">
            <img src="~/icon/newMember.png" alt="">
            <div class="d-flex flex-column fs-4 text-start ps-2">
                <span>{{todayInfo.memberCount}}</span>
                <span class="fs-6 sub-title">新增會員</span>
            </div>
        </div>
    </div>
    <div class="today-info today-chart row m-0 mt-4 justify-content-around">
        <div class="col-3">
            <canvas id="myPie"></canvas>
        </div>
        <div class="col-7">
            <canvas id="myLine"></canvas>
        </div>
    </div>
</div>
<script>

    let chartApp = new Vue({
        el:"#chartDiv",
        data:{
            todayInfo:{},
            pieData:{
                labels: [
                    ],
                datasets: [{
                        label: '分類貼文總數',
                        data: [],
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)'
                        ],
                        hoverOffset: 4
                }]
            },
            pieChart:""
        },
        mounted: function() {
            const self = this;
            const pie = this.pieData;
            const data = pie.datasets;
            axios.get("../Api/Chart/GetTodayInfo")
            .then(res => {
                self.todayInfo = res.data;
                for(let d of res.data.categoryPostCount){
                    pie.labels[pie.labels.length] = d.category;
                    data[0].data[data[0].data.length] = d.count;
                }
                const config = {
                    type: 'doughnut',
                    data: self.pieData,
                };

                const myChart = new Chart(
                    document.getElementById('myPie'),
                    config
                );
            });

        },
        methods:{
        }
    });


    //圓餅
    //const data = {
    //    labels: chartApp.pieData.labels,
    //    datasets: [{
    //        label: 'My First Dataset',
    //        data: chartApp.pieData.datasets[0].data,
    //        backgroundColor: [
    //            'rgb(255, 99, 132)',
    //            'rgb(54, 162, 235)',
    //            'rgb(255, 205, 86)'
    //        ],
    //        hoverOffset: 4
    //    }]
    //};
    //const config = {
    //    type: 'doughnut',
    //    data: chartApp.pieData,
    //};

    //const myChart = new Chart(
    //    document.getElementById('myPie'),
    //    config
    //);

    //長條
    const labels = [
        'January',
        'February',
        'March',
        'April',
        'May',
        'June',
    ];
    const data2 = {
        labels: labels,
        datasets: [{
            label: 'My First Dataset',
            data: [65, 59, 80, 81, 56, 55, 40],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 205, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(201, 203, 207, 0.2)'
            ],
            borderColor: [
                'rgb(255, 99, 132)',
                'rgb(255, 159, 64)',
                'rgb(255, 205, 86)',
                'rgb(75, 192, 192)',
                'rgb(54, 162, 235)',
                'rgb(153, 102, 255)',
                'rgb(201, 203, 207)'
            ],
            borderWidth: 1
        }]
    };

    const config2 = {
        type: 'bar',
        data: data2,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        },
    };

    const myChart2 = new Chart(
        document.getElementById('myLine'),
        config2
    );
</script>